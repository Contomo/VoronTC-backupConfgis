


[gcode_macro DEBUG_OUTPUT]
description: "evaluate gcode macros/jinja code at runtime for testing."
             "Usage: DEBUG_OUTPUT <HELLO>=\"<{action_respond_info('WORLD')}>\""
gcode:
    {% set gcode = printer.printer.lookup_object('gcode') %}
    {% set gm    = printer.printer.lookup_object('gcode_macro') %}
    {% set ctx   = gm.create_template_context() %}
    {% for key, val in params.items() if params %}
        {% if '{' not in val and '}' not in val and not val.startswith('RESPOND') and not val.startswith("{'RESPOND") %}
            {% set val = ('{action_respond_info((' ~ val ~ ')|string|e)}') %}
        {% endif %}
        {% set rendered = gm.env.from_string(val).render(ctx) %}
        {% set _        = (gcode.run_script_from_command(rendered)) if rendered else action_respond_info(rendered|string|e) %}
        {action_respond_info(key)}
    {% else %}
        {action_respond_info("Usage: DEBUG_OUTPUT <HELLO>=\"<{action_respond_info('WORLD')}>\"")}
    {% endfor %}